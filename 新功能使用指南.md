# PPT转视频工具 - 新功能使用指南

## 🚀 快速开始

1. **启动应用**
   ```bash
   python -m streamlit run main.py
   ```

2. **访问应用**: http://localhost:8502

## 🔧 配置持久化功能

### 自动配置加载
- **功能**: 启动时自动加载上次保存的配置
- **配置文件**: `config_data/app_config.json`
- **好处**: 无需每次重新设置参数

### 配置管理
在侧边栏中可以看到：
- **当前配置信息**: 显示项目名称、TTS语音、视频分辨率等
- **重置配置按钮**: 恢复默认设置
- **自动保存**: 配置更改时自动保存

### 配置项说明
- `project_name`: 项目名称
- `tts_voice`: TTS语音模型
- `video_resolution`: 视频分辨率
- `include_subtitles`: 是否包含字幕
- `subtitle_fontsize`: 字幕字体大小

## 📊 任务管理功能

### 任务状态跟踪
每个处理步骤都会被记录：
- **未执行** (PENDING): 尚未开始的任务
- **运行中** (RUNNING): 正在执行的任务
- **已完成** (COMPLETED): 成功完成的任务
- **失败** (FAILED): 执行失败的任务

### 任务记录文件
- **位置**: `output/[项目名]/task_records.xlsx`
- **内容**: 详细的任务执行记录
- **字段**: 任务ID、名称、状态、开始时间、结束时间、执行时长、结果

### 进度可视化
在主界面可以看到：
- **步骤概览**: 每个步骤的完成情况
- **进度条**: 实时进度显示
- **任务详情**: 具体任务的执行状态

### 工作流恢复
- **自动检测**: 启动时检测未完成的任务
- **继续执行**: 从中断处继续执行
- **状态同步**: 实时更新任务状态

## 📈 任务报告

### 自动生成报告
- **文件格式**: Excel (.xlsx)
- **命名规则**: `task_report_YYYYMMDD_HHMMSS.xlsx`
- **内容**: 详细的任务执行统计和分析

### 报告内容
- 任务执行摘要
- 步骤完成情况
- 执行时间分析
- 失败任务详情

## 🛠 高级功能

### 配置管理API
```python
from utils.config_manager import ConfigManager

# 创建配置管理器
config_manager = ConfigManager()

# 加载配置
config = config_manager.load_config()

# 保存配置
config_manager.save_config(config)

# 重置配置
config_manager.reset_to_defaults()
```

### 任务管理API
```python
from utils.task_manager import TaskManager, TaskStatus

# 创建任务管理器
task_manager = TaskManager(project_dir)

# 初始化任务
task_manager.initialize_tasks(slides_data)

# 更新任务状态
task_manager.update_task_status(
    task_id="tts_slide_001",
    status=TaskStatus.COMPLETED,
    result="成功生成语音"
)

# 获取步骤摘要
summary = task_manager.get_step_summary()
```

## 📝 使用建议

### 最佳实践
1. **配置一次使用**: 首次配置后，系统会自动保存配置
2. **监控进度**: 通过任务管理界面实时查看处理进度
3. **错误恢复**: 出现错误时，查看任务报告了解详情
4. **性能优化**: 根据任务报告分析执行时间，优化配置

### 故障排除
1. **配置丢失**: 检查 `config_data/app_config.json` 是否存在
2. **任务状态异常**: 查看项目目录下的 `task_records.xlsx`
3. **性能问题**: 分析任务报告中的执行时间数据

## 🔍 测试验证

运行测试脚本验证功能：
```bash
python test_new_features.py
```

查看功能验证页面：
```bash
python -m streamlit run 功能验证.py --server.port=8503
```

## 💡 技术细节

### 依赖包
- `pandas`: 数据管理
- `openpyxl`: Excel文件操作
- `streamlit`: Web界面

### 文件结构
```
config_data/
├── app_config.json          # 配置文件
utils/
├── config_manager.py        # 配置管理器
├── task_manager.py          # 任务管理器
output/
└── [项目名]/
    ├── task_records.xlsx    # 任务记录
    └── task_report_*.xlsx   # 任务报告
```

---

🎉 享受使用新的配置持久化和任务管理功能！
